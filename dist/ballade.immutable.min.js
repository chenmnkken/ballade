!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Ballade=e()}}(function(){return function e(t,r,n){function a(i,o){if(!r[i]){if(!t[i]){var u="function"==typeof require&&require;if(!o&&u)return u(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[i]={exports:{}};t[i][0].call(l.exports,function(e){var r=t[i][1][e];return a(r?r:e)},l,l.exports,e,t,r,n)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}({1:[function(e,t,r){},{}],2:[function(e,t,r){"use strict";var n=e("./queue"),a=e("./schema"),s=e("./mutable-store"),i=e("./immutable-store"),o={version:"1.0.0",Schema:a},u=function(){this.actionTypes={},this.storeQueue=[],this.id=Date.now()+Math.round(1e3*Math.random()),this.middlewareQueue=new n(function(e){this.__invokeCallback__(e)}.bind(this),!0)};u.prototype={__invokeCallback__:function(e){this.storeQueue.forEach(function(t){var r,n=t.callbacks[e.type];"function"==typeof n&&(r=n(t.store,e),void 0!==r&&t.store.event.publish(r))})},use:function(e){"function"==typeof e&&this.middlewareQueue.enter(e)},__dispatch__:function(e,t){var r,n=t(),a=this.actionTypes,s=n.type;if(!s)throw new Error("action type does not exist in \n"+JSON.stringify(n,null,2));if(r=a[s]){if(r!==e)throw new Error('action type "'+s+'" is duplicate')}else a[s]=e;this.middlewareQueue.execute(n)},createActions:function(e){var t,r,n=(this.id++).toString(32),a=this,s={};for(t in e)r=e[t],s[t]=function(e,t){return function(){var r=arguments;a.__dispatch__(t,function(){return e.apply(null,Array.prototype.slice.call(r))})}}(r,n);return s},createMutableStore:function(e,t){if(!t)throw new Error("schema must in createMutableStore arguments");var r=new s(e),n={mutable:{},event:{}};return n.mutable.get=r.mutable.get.bind(r.mutable),n.event.subscribe=r.event.subscribe.bind(r.event),n.event.unsubscribe=r.event.unsubscribe.bind(r.event),this.storeQueue.push({store:r,callbacks:t}),n},createImmutableStore:function(e,t){if(!t)throw new Error("schema must in createImmutableStore arguments");var r=new i(e),n={immutable:{},event:{}};return n.immutable.get=r.immutable.get.bind(r.immutable),n.event.subscribe=r.event.subscribe.bind(r.event),n.event.unsubscribe=r.event.unsubscribe.bind(r.event),this.storeQueue.push({store:r,callbacks:t}),n}},o.Dispatcher=u,t.exports=o},{"./immutable-store":5,"./mutable-store":6,"./queue":7,"./schema":8}],3:[function(e,t,r){function n(e,t,r){if(!(e instanceof Object))return e;var a,s=Object.prototype.toString.call(e).slice(8,-1);switch(s){case"Array":a=[];break;case"Date":a=new Date(e.getTime());break;case"RegExp":a=new RegExp(e);break;case"Function":break;case"Uint8Array":case"Uint8ClampedArray":case"Uint16Array":case"Uint32Array":case"Int8Array":case"Int16Array":case"Int32Array":case"Float32Array":case"Float64Array":a=e.subarray();break;default:a={}}if(t.push(e),r.push(a),e instanceof Array)for(var i=0;i<e.length;i++)a[i]=n(e[i],t,r);for(var o=Object.keys(e).sort(),u=Object.keys(a).sort(),c=0;c<o.length;c++){var l=o[c];if(u.length>0&&l===u[0])u.shift();else if(Object.prototype.hasOwnProperty.call(e,l)){var f=e[l],h=t.indexOf(f);a[l]=-1!==h?r[h]:n(e[l],t,r)}}return a}t.exports=function(e){return n(e,[],[])}},{}],4:[function(e,t,r){"use strict";var n=function(){this.handlers=[]};n.prototype={publish:function(e){this.handlers.forEach(function(t){t.type?t.type===e&&t.handler(e):t.handler(e)})},subscribe:function(e,t){var r={};"function"==typeof e?r.handler=e:(r.handler=t,r.type=e),this.handlers.push(r)},unsubscribe:function(e,t){"function"==typeof e&&(t=e,e=null);for(var r,n=0,a=!1;n<this.handlers.length;n++)r=this.handlers[n],r.type?e&&t?a=r.type===e&&r.handler===t:e?a=r.type===e:t&&(a=r.handler===t):a=r.handler===t,a&&this.handlers.splice(n--,1)}},t.exports=n},{}],5:[function(e,t,r){"use strict";var n,a=Object.prototype.toString,s=e("./event");n="undefined"!=typeof self&&self.Immutable?self.Immutable:"undefined"!=typeof global&&global.Immutable?global.Immutable:e("immutable");var i=function(e){return a.call(e).slice(8,-1)},o=function(e){var t=i(e);return"Array"===t||"Object"===t?n.fromJS(e):e},u=function(e){this.store={},this.schema=e;var t=this.schema.defaultData;Object.keys(t).forEach(function(e){this.store[e]=o(t[e])}.bind(this))};u.prototype={set:function(e,t){var r="Function"===i(t.toJS),n=this.schema.validator(e,t,r);return n.messages&&n.messages.forEach(function(e){"warning"===e.type||"error"===e.type}),"value"in n?(this.store[e]=r?n.value:o(n.value),e):void 0},get:function(e){return this.store[e]},"delete":function(e){return delete this.store[e],e}};var c=function(e){this.immutable=new u(e),this.event=new s};t.exports=c},{"./event":4,immutable:1}],6:[function(e,t,r){"use strict";var n=e("./copy"),a=e("./event"),s={string:!0,number:!0,"null":!0,undefind:!0,"boolean":!0},i=function(e){this.store={},this.schema=e;var t=this.schema.defaultData;Object.keys(t).forEach(function(e){this.store[e]=t[e]}.bind(this))};i.prototype={set:function(e,t){var r=this.schema.validator(e,t);return r.messages&&r.messages.forEach(function(e){"warning"===e.type||"error"===e.type}),"value"in r?(this.store[e]=r.value,e):void 0},get:function(e){var t=this.store[e],r=typeof t;return s[r]?t:n(t)},"delete":function(e){return delete this.store[e],e}};var o=function(e){this.mutable=new i(e),this.event=new a};t.exports=o},{"./copy":3,"./event":4}],7:[function(e,t,r){"use strict";var n=function(e,t){this.workflows=[],this.completeCallback=e,t&&(this._workflows=[])};n.prototype={enter:function(e){this.workflows.push(e),this._workflows&&this._workflows.push(e)},execute:function(e,t){t=t||this.workflows.concat();var r;t.length?(r=t.shift())(e,this.execute.bind(this,e,t)):(this._workflows&&(this.workflows=this._workflows.concat()),t=null,this.completeCallback(e))}},t.exports=n},{}],8:[function(e,t,r){"use strict";var n="__schemaType__",a="__schemaTypeHook__",s="__schemaContainer__",i="__schemaItem__",o="__schemaConstructor__",u="__schemaChild__",c=Object.prototype.toString,l=function(e,t){return t&&"function"==typeof e.toJS&&(e=e.toJS()),c.call(e).slice(8,-1)},f=function(e,t,r,n){return n?e=e.set(t,r):e[t]=r,e},h=function(e,t,r){return r?e.get(t):e[t]},p=function(e,t,r){r?e["delete"](t):Array.isArray(e)?e.splice(t,1):delete e[t]},m={$required:function(e){return e},$default:function(e,t){return null===e||void 0===e?"Function"===l(t)?t():t:e},$validate:function(e,t){return t(e)},String:{$lowercase:function(e){return e.toLowerCase()},$uppercase:function(e){return e.toUpperCase()},$trim:function(e){return e.trim()},$match:function(e,t){if("RegExp"!==l(t))throw new Error("Schema Options Error: `match` property must be RegExp");return t.test(e)?e:void 0},$enum:function(e,t){if(!Array.isArray(t)||!t.length)throw new Error("Schema Options Error: `enum` must be correct Array");return~t.indexOf(e)?e:void 0}},Number:{$min:function(e,t){return e>=t?e:void 0},$max:function(e,t){return t>=e?e:void 0}}};m.Date=m.Number;var v=function(e,t,r){var a={};if(null===t||void 0===t)return a.message={path:e,originalValue:t,type:"error",message:"Value is invalid"},a;try{a.value=r[o](t),a.message={path:e,originalValue:t,type:"warning",message:"Expect type is "+r[n]+", not "+l(t)}}catch(s){a.message={path:e,originalValue:t,type:"error",message:"Cast to "+r[n]+" failed, "+s.message}}return"Number"===r[n]?isFinite(a.value)||(a.message={path:e,originalValue:t,type:"error",message:"Cast to "+r[n]+" failed"},delete a.value):"String"===r[n]&&"object"==typeof t&&(a.message={path:e,originalValue:t,type:"error",message:"Cast to "+r[n]+" failed"},delete a.value),a},d=function(e,t,r){var c=Array.isArray(e),f=c?e.slice(0,1):Object.keys(e);f.forEach(function(f){var h=c?f:e[f];if(f=c?i:f,t[f]={},"function"==typeof h)t[f][n]=h.name,t[f][o]=h;else if(Array.isArray(h)){if(t[f][s]="Array",!h.length)return void(t[f][n]="Mixed");r[f]=[],d(h,t[f],r[f])}else{if("Object"!==l(h))throw new Error("Set `"+f+"` schema error, may be forget set `$type` property or `type Constructor Function`");if(!Object.keys(h).length)return void(t[f][n]="Mixed");"function"==typeof h.$type?(t[f][n]=h.$type.name,t[f][o]=h.$type,t[f][a]=[],Object.keys(h).forEach(function(e){"$type"!==e&&h[e]&&(t[f][a].push({key:e,value:h[e]}),"default"===e&&("Function"===l(h[e])?f===i?r.push(h.$default()):r[f]=h.$default():f===i?r.push(h.$default):r[f]=h.$default))}),t[f][a].length||delete t[f][a]):h instanceof _?(t[f][n]="Schema",t[f][u]=h,f===i?Object.keys(h.defaultData).length&&r.push(h.defaultData):r[f]=h.defaultData):(t[f][s]="Object",r[f]={},d(h,t[f],r[f]))}})},y=function(e,t){var r={},s=t[n];return t[a].forEach(function(t){if(!r.message){var n=t.key,a=t.value,i=m[n]||m[s][n];i&&(e=i(e,a),void 0===e&&(r.message="Value convert faild for `"+n+"` schema options"))}}),r.value=e,r},b=function(e,t,r,i){var o={},u=[],c=this;return Object.keys(t).forEach(function(o){if("__schema"!==o.slice(0,8)){var m,d,m,b,g=t[o],w=h(e,o,i),_=r+"."+o;g[s]?(d=c.validator(o,w,i,g,_),e=f(e,o,d.value,i),d.messages&&(u=u.concat(d.messages))):(void 0!==w&&l(w)!==g[n]&&(d=v(_,w,g),"value"in d?e=f(e,o,d.value,i):p(e,o,i),d.message&&u.push(d.message)),g[a]&&(b=h(e,o,i),m=y(b,g),e=f(e,o,m.value,i),m.message&&(u.push({path:_,originalValue:b,type:"error",message:m.message}),p(e,o,i))))}}),o.value=e,u.length&&(o.messages=u),o},g=function(e,t,r,o){var c={},m=[],d=this,g=t[i],w=g[s],_=g[n],k=g[u],O=g[a];return e.forEach(function(t,n){var a,s,a,u,c,x=!0,E=r+"["+n+"]";w?(s=d.validator(i,t,o,g,E),e=f(e,n,s.value,o),s.messages&&(m=m.concat(s.messages))):"Schema"===_?(c=b.call(d,t,k.dataTypes,E,o),"value"in c&&(e=f(e,n,c.value,o)),"messages"in c&&(m=m.concat(c.messages))):(l(t)!==_&&(s=v(E,t,g),"value"in s?e=f(e,n,s.value,o):(p(e,n,o),x=!1),s.message&&m.push(s.message)),x&&O&&(u=h(e,n,o),a=y(u,g),e=f(e,n,a.value,o),a.message&&(m.push({path:E,originalValue:u,type:"error",message:a.message}),p(e,n,o))))}),c.value=e,m.length&&(c.messages=m),c},w=function(e,t,r){var s,i,o={},u=[],c=l(e);return t[n]===c?o.value=e:(i=v(r,e,t),"value"in i&&(o.value=i.value),i.message&&u.push(i.message)),"value"in o&&t[a]&&(s=y(o.value,t),o.value=s.value,s.message&&(u.push({path:r,originalValue:o.value,type:"error",message:s.message}),delete o.value)),u.length&&(o.messages=u),o},_=function(e){if("Object"!==l(e))throw new Error("Schema type must be plain Object");this.dataTypes={},this.defaultData={},d(e,this.dataTypes,this.defaultData)};_.prototype={validator:function(e,t,r,a,i){a=a||this.dataTypes[e],i=i||e;var o=a[s],c=l(t,r);return a?"Mixed"===a[n]?{value:t}:"Schema"===a[n]?b.call(this,t,a[u].dataTypes,i,r):"Array"===o&&"Array"===c?g.call(this,t,a,i,r):"Object"===o&&"Object"===c?b.call(this,t,a,i,r):w.call(this,t,a,i):[{path:i,originalValue:t,type:"error",message:"Not declared in Schema"}]}},t.exports=_},{}]},{},[2])(2)});