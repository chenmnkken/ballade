!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Ballade=e()}}(function(){return function e(t,r,a){function n(i,o){if(!r[i]){if(!t[i]){var u="function"==typeof require&&require;if(!o&&u)return u(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[i]={exports:{}};t[i][0].call(l.exports,function(e){var r=t[i][1][e];return n(r?r:e)},l,l.exports,e,t,r,a)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<a.length;i++)n(a[i]);return n}({1:[function(e,t,r){"use strict";var a=e("./queue"),n=e("./schema"),s=e("./mutable-store"),i={version:"1.0.0",Schema:n},o=function(){this.actionTypes={},this.storeQueue=[],this.id=Date.now()+Math.round(1e3*Math.random()),this.middlewareQueue=new a(function(e){this.__invokeCallback__(e)}.bind(this),!0)};o.prototype={__invokeCallback__:function(e){this.storeQueue.forEach(function(t){var r,a=t.callbacks[e.type];"function"==typeof a&&(r=a(t.store,e),void 0!==r&&t.store.event.publish(r))})},use:function(e){"function"==typeof e&&this.middlewareQueue.enter(e)},__dispatch__:function(e,t){var r,a=t(),n=this.actionTypes,s=a.type;if(!s)throw new Error("action type does not exist in \n"+JSON.stringify(a,null,2));if(r=n[s]){if(r!==e)throw new Error('action type "'+s+'" is duplicate')}else n[s]=e;this.middlewareQueue.execute(a)},createActions:function(e){var t,r,a=(this.id++).toString(32),n=this,s={};for(t in e)r=e[t],s[t]=function(e,t){return function(){var r=arguments;n.__dispatch__(t,function(){return e.apply(null,Array.prototype.slice.call(r))})}}(r,a);return s},createMutableStore:function(e,t){if(!t)throw new Error("schema must in createMutableStore arguments");var r=new s(e),a={mutable:{},event:{}};return a.mutable.get=r.mutable.get.bind(r.mutable),a.event.subscribe=r.event.subscribe.bind(r.event),a.event.unsubscribe=r.event.unsubscribe.bind(r.event),this.storeQueue.push({store:r,callbacks:t}),a}},i.Dispatcher=o,t.exports=i},{"./mutable-store":4,"./queue":5,"./schema":6}],2:[function(e,t,r){function a(e,t,r){if(!(e instanceof Object))return e;var n,s=Object.prototype.toString.call(e).slice(8,-1);switch(s){case"Array":n=[];break;case"Date":n=new Date(e.getTime());break;case"RegExp":n=new RegExp(e);break;case"Function":break;case"Uint8Array":case"Uint8ClampedArray":case"Uint16Array":case"Uint32Array":case"Int8Array":case"Int16Array":case"Int32Array":case"Float32Array":case"Float64Array":n=e.subarray();break;default:n={}}if(t.push(e),r.push(n),e instanceof Array)for(var i=0;i<e.length;i++)n[i]=a(e[i],t,r);for(var o=Object.keys(e).sort(),u=Object.keys(n).sort(),c=0;c<o.length;c++){var l=o[c];if(u.length>0&&l===u[0])u.shift();else if(Object.prototype.hasOwnProperty.call(e,l)){var f=e[l],h=t.indexOf(f);n[l]=-1!==h?r[h]:a(e[l],t,r)}}return n}t.exports=function(e){return a(e,[],[])}},{}],3:[function(e,t,r){"use strict";var a=function(){this.handlers=[]};a.prototype={publish:function(e){this.handlers.forEach(function(t){t.type?t.type===e&&t.handler(e):t.handler(e)})},subscribe:function(e,t){var r={};"function"==typeof e?r.handler=e:(r.handler=t,r.type=e),this.handlers.push(r)},unsubscribe:function(e,t){"function"==typeof e&&(t=e,e=null);for(var r,a=0,n=!1;a<this.handlers.length;a++)r=this.handlers[a],r.type?e&&t?n=r.type===e&&r.handler===t:e?n=r.type===e:t&&(n=r.handler===t):n=r.handler===t,n&&this.handlers.splice(a--,1)}},t.exports=a},{}],4:[function(e,t,r){"use strict";var a=e("./copy"),n=e("./event"),s={string:!0,number:!0,"null":!0,undefind:!0,"boolean":!0},i=function(e){this.store={},this.schema=e;var t=this.schema.defaultData;Object.keys(t).forEach(function(e){this.store[e]=t[e]}.bind(this))};i.prototype={set:function(e,t){var r=this.schema.validator(e,t);return r.messages&&r.messages.forEach(function(e){"warning"===e.type||"error"===e.type}),"value"in r?(this.store[e]=r.value,e):void 0},get:function(e){var t=this.store[e],r=typeof t;return s[r]?t:a(t)},"delete":function(e){return delete this.store[e],e}};var o=function(e){this.mutable=new i(e),this.event=new n};t.exports=o},{"./copy":2,"./event":3}],5:[function(e,t,r){"use strict";var a=function(e,t){this.workflows=[],this.completeCallback=e,t&&(this._workflows=[])};a.prototype={enter:function(e){this.workflows.push(e),this._workflows&&this._workflows.push(e)},execute:function(e,t){t=t||this.workflows.concat();var r;t.length?(r=t.shift())(e,this.execute.bind(this,e,t)):(this._workflows&&(this.workflows=this._workflows.concat()),t=null,this.completeCallback(e))}},t.exports=a},{}],6:[function(e,t,r){"use strict";var a="__schemaType__",n="__schemaTypeHook__",s="__schemaContainer__",i="__schemaItem__",o="__schemaConstructor__",u="__schemaChild__",c=Object.prototype.toString,l=function(e,t){return t&&"function"==typeof e.toJS&&(e=e.toJS()),c.call(e).slice(8,-1)},f=function(e,t,r,a){return a?e=e.set(t,r):e[t]=r,e},h=function(e,t,r){return r?e.get(t):e[t]},p=function(e,t,r){r?e["delete"](t):Array.isArray(e)?e.splice(t,1):delete e[t]},d={$required:function(e){return e},$default:function(e,t){return null===e||void 0===e?"Function"===l(t)?t():t:e},$validate:function(e,t){return t(e)},String:{$lowercase:function(e){return e.toLowerCase()},$uppercase:function(e){return e.toUpperCase()},$trim:function(e){return e.trim()},$match:function(e,t){if("RegExp"!==l(t))throw new Error("Schema Options Error: `match` property must be RegExp");return t.test(e)?e:void 0},$enum:function(e,t){if(!Array.isArray(t)||!t.length)throw new Error("Schema Options Error: `enum` must be correct Array");return~t.indexOf(e)?e:void 0}},Number:{$min:function(e,t){return e>=t?e:void 0},$max:function(e,t){return t>=e?e:void 0}}};d.Date=d.Number;var y=function(e,t,r){var n={};if(null===t||void 0===t)return n.message={path:e,originalValue:t,type:"error",message:"Value is invalid"},n;try{n.value=r[o](t),n.message={path:e,originalValue:t,type:"warning",message:"Expect type is "+r[a]+", not "+l(t)}}catch(s){n.message={path:e,originalValue:t,type:"error",message:"Cast to "+r[a]+" failed, "+s.message}}return"Number"===r[a]?isFinite(n.value)||(n.message={path:e,originalValue:t,type:"error",message:"Cast to "+r[a]+" failed"},delete n.value):"String"===r[a]&&"object"==typeof t&&(n.message={path:e,originalValue:t,type:"error",message:"Cast to "+r[a]+" failed"},delete n.value),n},v=function(e,t,r){var c=Array.isArray(e),f=c?e.slice(0,1):Object.keys(e);f.forEach(function(f){var h=c?f:e[f];if(f=c?i:f,t[f]={},"function"==typeof h)t[f][a]=h.name,t[f][o]=h;else if(Array.isArray(h)){if(t[f][s]="Array",!h.length)return void(t[f][a]="Mixed");r[f]=[],v(h,t[f],r[f])}else{if("Object"!==l(h))throw new Error("Set `"+f+"` schema error, may be forget set `$type` property or `type Constructor Function`");if(!Object.keys(h).length)return void(t[f][a]="Mixed");"function"==typeof h.$type?(t[f][a]=h.$type.name,t[f][o]=h.$type,t[f][n]=[],Object.keys(h).forEach(function(e){"$type"!==e&&h[e]&&(t[f][n].push({key:e,value:h[e]}),"default"===e&&("Function"===l(h[e])?f===i?r.push(h.$default()):r[f]=h.$default():f===i?r.push(h.$default):r[f]=h.$default))}),t[f][n].length||delete t[f][n]):h instanceof _?(t[f][a]="Schema",t[f][u]=h,f===i?Object.keys(h.defaultData).length&&r.push(h.defaultData):r[f]=h.defaultData):(t[f][s]="Object",r[f]={},v(h,t[f],r[f]))}})},m=function(e,t){var r={},s=t[a];return t[n].forEach(function(t){if(!r.message){var a=t.key,n=t.value,i=d[a]||d[s][a];i&&(e=i(e,n),void 0===e&&(r.message="Value convert faild for `"+a+"` schema options"))}}),r.value=e,r},g=function(e,t,r,i){var o={},u=[],c=this;return Object.keys(t).forEach(function(o){if("__schema"!==o.slice(0,8)){var d,v,d,g,b=t[o],w=h(e,o,i),_=r+"."+o;b[s]?(v=c.validator(o,w,i,b,_),e=f(e,o,v.value,i),v.messages&&(u=u.concat(v.messages))):(void 0!==w&&l(w)!==b[a]&&(v=y(_,w,b),"value"in v?e=f(e,o,v.value,i):p(e,o,i),v.message&&u.push(v.message)),b[n]&&(g=h(e,o,i),d=m(g,b),e=f(e,o,d.value,i),d.message&&(u.push({path:_,originalValue:g,type:"error",message:d.message}),p(e,o,i))))}}),o.value=e,u.length&&(o.messages=u),o},b=function(e,t,r,o){var c={},d=[],v=this,b=t[i],w=b[s],_=b[a],k=b[u],x=b[n];return e.forEach(function(t,a){var n,s,n,u,c,O=!0,A=r+"["+a+"]";w?(s=v.validator(i,t,o,b,A),e=f(e,a,s.value,o),s.messages&&(d=d.concat(s.messages))):"Schema"===_?(c=g.call(v,t,k.dataTypes,A,o),"value"in c&&(e=f(e,a,c.value,o)),"messages"in c&&(d=d.concat(c.messages))):(l(t)!==_&&(s=y(A,t,b),"value"in s?e=f(e,a,s.value,o):(p(e,a,o),O=!1),s.message&&d.push(s.message)),O&&x&&(u=h(e,a,o),n=m(u,b),e=f(e,a,n.value,o),n.message&&(d.push({path:A,originalValue:u,type:"error",message:n.message}),p(e,a,o))))}),c.value=e,d.length&&(c.messages=d),c},w=function(e,t,r){var s,i,o={},u=[],c=l(e);return t[a]===c?o.value=e:(i=y(r,e,t),"value"in i&&(o.value=i.value),i.message&&u.push(i.message)),"value"in o&&t[n]&&(s=m(o.value,t),o.value=s.value,s.message&&(u.push({path:r,originalValue:o.value,type:"error",message:s.message}),delete o.value)),u.length&&(o.messages=u),o},_=function(e){if("Object"!==l(e))throw new Error("Schema type must be plain Object");this.dataTypes={},this.defaultData={},v(e,this.dataTypes,this.defaultData)};_.prototype={validator:function(e,t,r,n,i){n=n||this.dataTypes[e],i=i||e;var o=n[s],c=l(t,r);return n?"Mixed"===n[a]?{value:t}:"Schema"===n[a]?g.call(this,t,n[u].dataTypes,i,r):"Array"===o&&"Array"===c?b.call(this,t,n,i,r):"Object"===o&&"Object"===c?g.call(this,t,n,i,r):w.call(this,t,n,i):[{path:i,originalValue:t,type:"error",message:"Not declared in Schema"}]}},t.exports=_},{}]},{},[1])(1)});